<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç›²ç›’è¯æ¡ Â· èšä¼šæ¸¸æˆ</title>
    <link href="https://fonts.googleapis.com/css2?family=Zhi+Mang+Xing&family=Ma+Shan+Zheng&family=Noto+Sans+SC:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-gradient-start: #ff6b9d;
            --bg-gradient-end: #ffa06b;
            --card-bg: rgba(255, 255, 255, 0.95);
            --text-primary: #2d2d2d;
            --text-secondary: #666;
            --accent-color: #ff4757;
            --success-color: #26de81;
            --shadow-color: rgba(255, 107, 157, 0.3);
        }

        body {
            font-family: 'Noto Sans SC', sans-serif;
            background: linear-gradient(135deg, var(--bg-gradient-start), var(--bg-gradient-end));
            min-height: 100vh;
            padding: 20px;
            position: relative;
            overflow-x: hidden;
        }

        /* è£…é¥°æ€§èƒŒæ™¯å…ƒç´  */
        body::before {
            content: '';
            position: fixed;
            top: -50%;
            right: -50%;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 1px, transparent 1px);
            background-size: 50px 50px;
            animation: float 20s linear infinite;
            z-index: 0;
        }

        @keyframes float {
            0% { transform: translate(0, 0); }
            100% { transform: translate(50px, 50px); }
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        header {
            text-align: center;
            margin-bottom: 40px;
            animation: slideDown 0.8s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        h1 {
            font-family: 'Ma Shan Zheng', cursive;
            font-size: 3.5rem;
            color: white;
            text-shadow: 4px 4px 8px rgba(0, 0, 0, 0.2);
            margin-bottom: 10px;
            letter-spacing: 4px;
        }

        .subtitle {
            font-size: 1.1rem;
            color: rgba(255, 255, 255, 0.9);
            font-weight: 300;
        }

        .card {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 25px;
            box-shadow: 0 10px 40px var(--shadow-color);
            backdrop-filter: blur(10px);
            animation: fadeInUp 0.6s ease;
            animation-fill-mode: both;
        }

        .card:nth-child(2) { animation-delay: 0.1s; }
        .card:nth-child(3) { animation-delay: 0.2s; }
        .card:nth-child(4) { animation-delay: 0.3s; }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        h2 {
            color: var(--text-primary);
            margin-bottom: 20px;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        h2::before {
            content: 'ğŸ²';
            font-size: 1.8rem;
        }

        .input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        input[type="text"] {
            flex: 1;
            padding: 12px 18px;
            border: 2px solid #ffe0e9;
            border-radius: 12px;
            font-size: 1rem;
            font-family: 'Noto Sans SC', sans-serif;
            transition: all 0.3s ease;
        }

        input[type="text"]:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(255, 71, 87, 0.1);
        }

        button {
            padding: 12px 28px;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Noto Sans SC', sans-serif;
            position: relative;
            overflow: hidden;
        }

        button::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        button:hover::before {
            width: 300px;
            height: 300px;
        }

        button span {
            position: relative;
            z-index: 1;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--accent-color), #ff6b9d);
            color: white;
            box-shadow: 0 4px 15px rgba(255, 71, 87, 0.4);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 71, 87, 0.5);
        }

        .btn-secondary {
            background: white;
            color: var(--accent-color);
            border: 2px solid var(--accent-color);
        }

        .btn-secondary:hover {
            background: var(--accent-color);
            color: white;
        }

        .btn-draw {
            width: 100%;
            padding: 20px;
            font-size: 1.3rem;
            background: linear-gradient(135deg, #feca57, #ff9ff3);
            color: white;
            box-shadow: 0 8px 25px rgba(254, 202, 87, 0.4);
            margin-top: 10px;
        }

        .btn-draw:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 35px rgba(254, 202, 87, 0.5);
        }

        .btn-draw:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .name-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }

        .name-tag {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 15px;
            background: linear-gradient(135deg, #ffeaa7, #fdcb6e);
            border-radius: 20px;
            font-size: 0.95rem;
            color: var(--text-primary);
            box-shadow: 0 2px 8px rgba(253, 203, 110, 0.3);
            animation: popIn 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        @keyframes popIn {
            0% {
                transform: scale(0);
                opacity: 0;
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        .name-tag .count {
            background: rgba(255, 255, 255, 0.7);
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.85rem;
            font-weight: 700;
        }

        .remove-btn {
            background: rgba(255, 71, 87, 0.8);
            color: white;
            border: none;
            border-radius: 50%;
            width: 22px;
            height: 22px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 0.9rem;
            padding: 0;
            transition: all 0.2s ease;
        }

        .remove-btn:hover {
            background: var(--accent-color);
            transform: rotate(90deg) scale(1.1);
        }

        .result-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 40px;
            border-radius: 20px;
            margin-top: 20px;
            box-shadow: 0 15px 50px rgba(102, 126, 234, 0.4);
            animation: resultAppear 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            position: relative;
            overflow: hidden;
        }

        .result-card::before {
            content: 'âœ¨';
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 3rem;
            opacity: 0.2;
            animation: sparkle 2s ease-in-out infinite;
        }

        @keyframes sparkle {
            0%, 100% { transform: scale(1) rotate(0deg); }
            50% { transform: scale(1.2) rotate(180deg); }
        }

        @keyframes resultAppear {
            0% {
                transform: scale(0.8) rotateX(90deg);
                opacity: 0;
            }
            100% {
                transform: scale(1) rotateX(0deg);
                opacity: 1;
            }
        }

        .result-name {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 20px;
            text-align: center;
            font-family: 'Ma Shan Zheng', cursive;
            text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.3);
        }

        .result-question {
            font-size: 1.3rem;
            line-height: 1.8;
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 12px;
            border-left: 4px solid white;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .stat-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 12px;
            text-align: center;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            color: var(--success-color);
        }

        .stat-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-top: 5px;
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: var(--text-secondary);
            font-size: 1.1rem;
        }

        .empty-state::before {
            content: 'ğŸ­';
            display: block;
            font-size: 4rem;
            margin-bottom: 15px;
            opacity: 0.5;
        }

        .history-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 10px;
            border-left: 4px solid var(--accent-color);
            animation: slideInLeft 0.4s ease;
        }

        @keyframes slideInLeft {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .history-name {
            font-weight: 700;
            color: var(--accent-color);
            margin-bottom: 5px;
        }

        .history-question {
            color: var(--text-secondary);
            font-size: 0.95rem;
        }

        @media (max-width: 600px) {
            h1 {
                font-size: 2.5rem;
            }

            .card {
                padding: 20px;
            }

            .result-name {
                font-size: 2rem;
            }

            .result-question {
                font-size: 1.1rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ ç›²ç›’è¯æ¡</h1>
            <div class="subtitle">èšä¼šæ¸¸æˆ Â· ä¸€èµ·ç©èµ·æ¥ï¼</div>
        </header>

        <!-- ç¬¬ä¸€æ­¥ï¼šæ·»åŠ å‚ä¸è€… -->
        <div class="card" id="step1Card">
            <h2>ç¬¬ä¸€æ­¥ï¼šæ·»åŠ å‚ä¸è€…</h2>
            <p style="color: var(--text-secondary); margin-bottom: 15px; font-size: 0.95rem;">
                ğŸ’¡ æç¤ºï¼šå¯ä»¥ä¸€æ¬¡æ€§è¾“å…¥å¤šä¸ªåå­—ï¼Œç”¨é€—å·åˆ†éš”ï¼ˆå¦‚ï¼šå¼ ä¸‰,æå››,ç‹äº”ï¼‰
            </p>
            <div class="input-group">
                <input type="text" id="nameInput" placeholder="è¾“å…¥åå­—ï¼Œå¤šä¸ªåå­—ç”¨é€—å·åˆ†éš”..." style="flex: 1;">
            </div>
            <div style="display: flex; gap: 10px; margin-top: 15px;">
                <button class="btn-primary" onclick="addNames()" style="flex: 1;">
                    <span>â• æ·»åŠ å‚ä¸è€…</span>
                </button>
                <button class="btn-secondary" onclick="clearAllNames()" style="flex: 1;">
                    <span>ğŸ—‘ï¸ æ¸…ç©ºå…¨éƒ¨</span>
                </button>
            </div>
            <div class="name-list" id="nameList"></div>
            <button class="btn-draw" id="startGameBtn" onclick="startGame()" disabled style="margin-top: 20px;">
                <span>ğŸ® å¼€å§‹æ¸¸æˆ</span>
            </button>
        </div>

        <!-- ç¬¬äºŒæ­¥ï¼šæ¸¸æˆè¿›è¡Œä¸­ -->
        <div class="card" id="step2Card" style="display: none;">
            <h2>ç¬¬äºŒæ­¥ï¼šéšæœºæŠ½å–</h2>
            <div class="stats">
                <div class="stat-item">
                    <div class="stat-number" id="totalNames">0</div>
                    <div class="stat-label">å‚ä¸äººæ•°</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="totalDraws">0</div>
                    <div class="stat-label">å·²æŠ½å–æ¬¡æ•°</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="remainingDraws">0</div>
                    <div class="stat-label">å‰©ä½™æ¬¡æ•°</div>
                </div>
            </div>
            <button class="btn-draw" id="drawBtn" onclick="drawName()">
                <span>ğŸ² éšæœºæŠ½å–</span>
            </button>
            <button class="btn-secondary" onclick="resetGame()" style="width: 100%; margin-top: 10px;">
                <span>ğŸ”„ é‡ç½®æ¸¸æˆ</span>
            </button>
        </div>

        <div id="resultContainer"></div>

        <div class="card">
            <h2>æŠ½å–å†å²</h2>
            <div id="historyList">
                <div class="empty-state">æš‚æ— æŠ½å–è®°å½•</div>
            </div>
        </div>
    </div>

    <script>
        const questions = [
            "ã€é«˜å…‰æ—¶åˆ»ã€‘ï¼šè¿™åå¹´é‡Œï¼Œä½ è§‰å¾—è‡ªå·±æœ€\"ç‰›\"çš„ä¸€ä¸ªç¬é—´æ˜¯ï¼Ÿ",
            "ã€æ‰“è„¸ã€‘ï¼šä»¥å‰æ·±ä¿¡ä¸ç–‘ï¼Œä½†ç°åœ¨å®Œå…¨æ¨ç¿»çš„ä¸€ä¸ªè§‚å¿µæ˜¯ï¼Ÿ",
            "ã€æ²»æ„ˆã€‘ï¼šæœ€è¿‘æ„Ÿåˆ°æœ€æ”¾æ¾ã€æœ€å¿«ä¹çš„ä¸€ä»¶äº‹æ˜¯ä»€ä¹ˆï¼Ÿ",
            "ã€ç–¯ç‹‚ã€‘ï¼šè¿™åå¹´åšè¿‡æœ€ä¸åƒä½ ã€æœ€ç–¯ç‹‚çš„ä¸€ä»¶äº‹ï¼Ÿ",
            "ã€é—æ†¾ã€‘ï¼šå¦‚æœèƒ½ç©¿è¶Šå›æ¯•ä¸šé‚£å¤©ï¼Œä½ æƒ³å¯¹è‡ªå·±è¯´çš„ä¸€å¥è¯ï¼Ÿ",
            "ã€ç§è‰ã€‘ï¼šæœ€è¿‘å…¥å‘çš„ä¸€ä¸ªæ–°çˆ±å¥½æˆ–è€…æ–°ä¸œè¥¿ï¼Ÿ",
            "ã€åæ§½ã€‘ï¼šæœ€è¿‘ç”Ÿæ´»/å·¥ä½œä¸­è®©ä½ æœ€æƒ³ç¿»ç™½çœ¼çš„ä¸€ä»¶äº‹ï¼Ÿ",
            "ã€æ¢¦æƒ³ã€‘ï¼šæŠ›å¼€ç°å®ä¸è°ˆï¼Œä½ ç°åœ¨æœ€æƒ³åšçš„ä¸€ä»¶äº‹æƒ…æ˜¯ï¼Ÿ",
            "ã€è´¢æ”¿å±æœºã€‘ï¼šè¯´ä¸€ä»¶ä½ æœ€è¿‘ä¹°è¿‡çš„ã€è§‰å¾—è‡ªå·±è„‘å­è¿›æ°´çš„\"æ™ºå•†ç¨\"äº§å“ã€‚",
            "ã€é«˜å…‰æ—¶åˆ»ã€‘ï¼šæ‰‹æœºç›¸å†Œé‡Œå“ªå¼ ç…§ç‰‡çœ‹èµ·æ¥æœ€å²æœˆé™å¥½ï¼Ÿ",
            "ã€å¯å®¤æ¶éœ¸ã€‘ï¼šç°åœ¨å¦ç™½ï¼šå½“å¹´åœ¨å®¿èˆï¼Œå“ªä»¶äº‹å…¶å®æ˜¯ä½ å¹²çš„ï¼Œä½†ä½ å½“æ—¶æ­»ä¸æ‰¿è®¤/ç”©é”…ç»™åˆ«äººäº†ï¼Ÿ",
            "ã€å­¦æµ·æ— æ¶¯ã€‘ï¼šå¤§å­¦å››å¹´ï¼Œå“ªé—¨è¯¾ä½ åˆ°ç°åœ¨éƒ½å®Œå…¨ä¸çŸ¥é“è€å¸ˆè®²äº†å•¥ï¼Œç”šè‡³è¿è€å¸ˆé•¿ä»€ä¹ˆæ ·éƒ½å¿˜äº†ï¼Ÿ",
            "ã€å¦‚æœæœ‰æ¥ç”Ÿã€‘ï¼šä¸‹è¾ˆå­æŠ•èƒï¼Œå¦‚æœåªèƒ½é€‰åœ¨åº§çš„ä¸€ä½åŒå­¦åšä½ çš„è€å…¬/è€å©†ï¼Œä½ é€‰è°ï¼Ÿ",
            "ã€å…¨å‘˜æ¶äººã€‘ï¼šæ­¤æ—¶æ­¤åˆ»ï¼Œä½ çœ‹åœ¨åº§çš„è°æœ€\"ä¸é¡ºçœ¼\"ï¼Ÿï¼ˆä¸ç®¡æ˜¯ç¾¡æ…•å«‰å¦’è¿˜æ˜¯æ¨ï¼‰ï¼Œè¯·æŒ‡å‡ºæ¥å¹¶è¯´å‡ºåŸå› ã€‚",
            "ã€çº¯çˆ±æˆ˜ç¥ã€‘ï¼šè¯´ä¸€ä»¶å½“å¹´ä¸ºäº†è¿½äººï¼ˆæˆ–æš—æ‹ï¼‰åšè¿‡çš„æœ€èˆ”ç‹—/æœ€çŸ«æƒ…çš„äº‹ã€‚ï¼ˆæ¯”å¦‚å†™è¿‡ä»€ä¹ˆé…¸æ‰ç‰™çš„è¯´è¯´ï¼Ÿï¼‰",
            "ã€è’å²›ä½™ç”Ÿã€‘ï¼šå¦‚æœæµè½è’å²›ï¼Œåªèƒ½å¸¦åœ¨åœºçš„ä¸€ä½åŒå­¦ä¸€èµ·æ±‚ç”Ÿï¼ˆä¸ä»…è¦æ´»ä¸‹å»ï¼Œè¿˜è¦ä¸æ— èŠï¼‰ï¼Œä½ ä¼šæ­»æ­»æŠ±ä½è°çš„å¤§è…¿ï¼Ÿ",
            "ã€ç‰¢åº•åç©¿ã€‘ï¼šå¦‚æœå’±ä»¬è¿™ç¾¤äººé‡Œæœ‰äººä¼šå› ä¸º\"å¹²äº†ä¸€ä»¶è ¢äº‹\"è€Œä¸Šç¤¾ä¼šæ–°é—»ï¼ˆæ¯”å¦‚å¤´å¡åœ¨æ æ†é‡Œï¼‰ï¼Œä½ è§‰å¾—å¤§æ¦‚ç‡ä¼šæ˜¯è°ï¼Ÿ",
            "ã€å¸¦å¨ƒé»‘æ´ã€‘ï¼šå¦‚æœä½ æœ‰æ€¥äº‹è¦æŠŠå­©å­å¯„å…»åœ¨ä¸€ä½åŒå­¦å®¶ä¸€å¤©ï¼Œä½ ç»å¯¹ä¸æ•¢äº¤ç»™è°ï¼Ÿï¼ˆè§‰å¾—ä»–/å¥¹ä¼šæŠŠå­©å­å¸¦åæˆ–è€…å¼„ä¸¢ï¼‰",
            "ã€å€Ÿé’±é¦–é€‰ã€‘ï¼šå¦‚æœä½ æ·±å¤œæ€¥éœ€å€Ÿ5ä¸‡å—é’±ï¼Œä¸”ä¸æƒ³è§£é‡ŠåŸå› ï¼Œä½ è§‰å¾—ç»™è°æ‰“ç”µè¯æˆåŠŸç‡æœ€é«˜ï¼Ÿ",
            "ã€å½“å¹´çš„ç™½æœˆå…‰ã€‘ï¼šè¯´å®è¯ï¼ˆä¸è®¸æ’’è°ï¼‰ï¼Œå¤§å­¦åˆšå…¥å­¦é‚£ä¼šå„¿ï¼Œä½ è§‰å¾—åœ¨åœºçš„å“ªä½å¼‚æ€§æœ€å¥½çœ‹/æœ€æœ‰æ°”è´¨ï¼Ÿï¼ˆæ³¨æ„ï¼šæ˜¯å½“å¹´ï¼å½“å¹´ï¼ç°åœ¨é•¿æ®‹äº†ä¸ç®—ã€‚ï¼‰",
            "ã€è¿Ÿåˆ°å¤§ç‹ã€‘ï¼šå¦‚æœæ˜å¤©æ—©ä¸Š8ç‚¹é›†åˆå»çˆ¬å±±ï¼Œä½ æ•¢æ‰“èµŒè°ä¸€å®šä¼šè¿Ÿåˆ°ï¼ˆæˆ–è€…æœ€åä¸€ä¸ªåˆ°ï¼‰",
            "ã€é…’åç°åŸå½¢ã€‘ï¼šå‡­å°è±¡ï¼Œè°å–å¤šä¹‹åæœ€ç–¯/è¯æœ€å¤š/æœ€éš¾ç¼ ï¼Ÿ",
            "ã€é€†ç”Ÿé•¿ã€‘ï¼šè¯·ç¯é¡¾å››å‘¨ï¼Œå‡­è‰¯å¿ƒè¯´ï¼Œä½ è§‰å¾—è°è¿™åå¹´å®Œå…¨æ²¡å˜è€ï¼Ÿ"
        ];

        let participants = [];
        let drawHistory = [];
        let usedQuestions = [];
        let gameStarted = false;

        function updateStats() {
            const totalNames = participants.length;
            const totalDraws = drawHistory.length;
            const maxPossibleDraws = totalNames * 2;
            const remainingDraws = Math.max(0, maxPossibleDraws - totalDraws);

            document.getElementById('totalNames').textContent = totalNames;
            document.getElementById('totalDraws').textContent = totalDraws;
            document.getElementById('remainingDraws').textContent = remainingDraws;
        }

        function addNames() {
            const input = document.getElementById('nameInput');
            const inputValue = input.value.trim();

            if (inputValue === '') {
                alert('è¯·è¾“å…¥åå­—ï¼');
                return;
            }

            // ä½¿ç”¨é€—å·ã€é¡¿å·ã€åˆ†å·åˆ†éš”åå­—
            const names = inputValue.split(/[,ï¼Œ;ï¼›ã€]/).map(n => n.trim()).filter(n => n !== '');

            if (names.length === 0) {
                alert('è¯·è¾“å…¥æœ‰æ•ˆçš„åå­—ï¼');
                return;
            }

            let addedCount = 0;
            let duplicateNames = [];

            names.forEach(name => {
                if (name.length > 20) {
                    alert(`åå­—"${name}"å¤ªé•¿äº†ï¼Œæœ€å¤š20ä¸ªå­—ç¬¦ï¼`);
                    return;
                }

                if (participants.some(p => p.name === name)) {
                    duplicateNames.push(name);
                } else {
                    participants.push({ name: name, count: 0 });
                    addedCount++;
                }
            });

            if (duplicateNames.length > 0) {
                alert(`ä»¥ä¸‹åå­—å·²å­˜åœ¨ï¼š${duplicateNames.join('ã€')}`);
            }

            if (addedCount > 0) {
                input.value = '';
                renderNameList();
                updateStartButton();
            }
        }

        function removeName(name) {
            if (gameStarted) {
                alert('æ¸¸æˆå·²å¼€å§‹ï¼Œæ— æ³•åˆ é™¤å‚ä¸è€…ï¼è¯·é‡ç½®æ¸¸æˆã€‚');
                return;
            }
            participants = participants.filter(p => p.name !== name);
            renderNameList();
            updateStartButton();
        }

        function clearAllNames() {
            if (participants.length === 0) {
                return;
            }
            if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰å‚ä¸è€…å—ï¼Ÿ')) {
                participants = [];
                renderNameList();
                updateStartButton();
            }
        }

        function updateStartButton() {
            const startBtn = document.getElementById('startGameBtn');
            startBtn.disabled = participants.length === 0;
        }

        function renderNameList() {
            const nameList = document.getElementById('nameList');
            if (participants.length === 0) {
                nameList.innerHTML = '<div class="empty-state">è¿˜æ²¡æœ‰å‚ä¸è€…ï¼Œå¿«æ¥æ·»åŠ å§ï¼</div>';
                return;
            }

            nameList.innerHTML = participants.map(p => {
                const countDisplay = gameStarted ? `<span class="count">${p.count}/2</span>` : '';
                const removeBtn = gameStarted ? '' : `<button class="remove-btn" onclick="removeName('${p.name.replace(/'/g, "\\'")}')">Ã—</button>`;
                
                return `
                    <div class="name-tag">
                        <span>${p.name}</span>
                        ${countDisplay}
                        ${removeBtn}
                    </div>
                `;
            }).join('');
        }

        function startGame() {
            if (participants.length === 0) {
                alert('è¯·å…ˆæ·»åŠ å‚ä¸è€…ï¼');
                return;
            }

            gameStarted = true;
            
            // éšè—ç¬¬ä¸€æ­¥ï¼Œæ˜¾ç¤ºç¬¬äºŒæ­¥
            document.getElementById('step1Card').style.display = 'none';
            document.getElementById('step2Card').style.display = 'block';
            
            updateStats();
            renderNameList();

            // æ»šåŠ¨åˆ°æ¸¸æˆå¡ç‰‡
            setTimeout(() => {
                document.getElementById('step2Card').scrollIntoView({ behavior: 'smooth', block: 'start' });
            }, 100);
        }

        function drawName() {
            if (participants.length === 0) {
                alert('è¯·å…ˆæ·»åŠ å‚ä¸è€…ï¼');
                return;
            }

            // ç­›é€‰å¯ä»¥è¢«æŠ½å–çš„äººï¼ˆè¢«æŠ½å–æ¬¡æ•°<2ï¼‰
            const availableParticipants = participants.filter(p => p.count < 2);

            if (availableParticipants.length === 0) {
                alert('æ‰€æœ‰äººéƒ½å·²ç»è¢«æŠ½å–2æ¬¡äº†ï¼æ¸¸æˆç»“æŸï¼');
                return;
            }

            // éšæœºé€‰æ‹©ä¸€ä¸ªäºº
            const randomPerson = availableParticipants[Math.floor(Math.random() * availableParticipants.length)];

            // é€‰æ‹©ä¸€ä¸ªæœªä½¿ç”¨è¿‡çš„é¢˜ç›®
            let question;
            if (usedQuestions.length >= questions.length) {
                // æ‰€æœ‰é¢˜ç›®éƒ½ç”¨è¿‡äº†ï¼Œé‡ç½®
                usedQuestions = [];
            }

            const availableQuestions = questions.filter(q => !usedQuestions.includes(q));
            question = availableQuestions[Math.floor(Math.random() * availableQuestions.length)];
            usedQuestions.push(question);

            // æ›´æ–°è®¡æ•°
            const person = participants.find(p => p.name === randomPerson.name);
            person.count++;

            // æ·»åŠ åˆ°å†å²
            drawHistory.push({ name: randomPerson.name, question: question, timestamp: new Date() });

            // æ˜¾ç¤ºç»“æœ
            showResult(randomPerson.name, question);

            // æ›´æ–°æ˜¾ç¤º
            renderNameList();
            updateStats();
            renderHistory();
        }

        function showResult(name, question) {
            const resultContainer = document.getElementById('resultContainer');
            resultContainer.innerHTML = `
                <div class="result-card">
                    <div class="result-name">ğŸ¯ ${name}</div>
                    <div class="result-question">${question}</div>
                </div>
            `;

            // æ»šåŠ¨åˆ°ç»“æœ
            setTimeout(() => {
                resultContainer.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }, 100);
        }

        function renderHistory() {
            const historyList = document.getElementById('historyList');
            if (drawHistory.length === 0) {
                historyList.innerHTML = '<div class="empty-state">æš‚æ— æŠ½å–è®°å½•</div>';
                return;
            }

            historyList.innerHTML = drawHistory.slice().reverse().map((item, index) => `
                <div class="history-item">
                    <div class="history-name">#${drawHistory.length - index} ${item.name}</div>
                    <div class="history-question">${item.question}</div>
                </div>
            `).join('');
        }

        function resetGame() {
            const confirmed = confirm('ç¡®å®šè¦é‡ç½®æ¸¸æˆå—ï¼Ÿè¿™å°†æ¸…ç©ºæ‰€æœ‰æŠ½å–è®°å½•å¹¶è¿”å›ç¬¬ä¸€æ­¥ï¼');
            
            if (!confirmed) {
                return;
            }
            
            // é‡ç½®æ‰€æœ‰è®¡æ•°
            for (let i = 0; i < participants.length; i++) {
                participants[i].count = 0;
            }
            
            drawHistory = [];
            usedQuestions = [];
            gameStarted = false;
            
            // æ˜¾ç¤ºç¬¬ä¸€æ­¥ï¼Œéšè—ç¬¬äºŒæ­¥
            const step1Card = document.getElementById('step1Card');
            const step2Card = document.getElementById('step2Card');
            
            if (step1Card) step1Card.style.display = 'block';
            if (step2Card) step2Card.style.display = 'none';
            
            // æ¸…ç©ºç»“æœå®¹å™¨
            const resultContainer = document.getElementById('resultContainer');
            if (resultContainer) resultContainer.innerHTML = '';
            
            // æ›´æ–°æ˜¾ç¤º
            renderNameList();
            renderHistory();
            updateStartButton();
            
            // æ»šåŠ¨åˆ°é¡¶éƒ¨
            setTimeout(() => {
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }, 100);
        }

        // æ”¯æŒå›è½¦é”®æ·»åŠ åå­—
        document.getElementById('nameInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                addNames();
            }
        });

        // åˆå§‹åŒ–
        renderNameList();
        renderHistory();
        updateStartButton();
    </script>
</body>
</html>
